# yamdb_final
yamdb_final
![example workflow](https://github.com/Ampolirosinvest/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)


## Описание

REST API для социальной сети блогеров Yatube.
Развернут на боевом сервере в ЯндексОблако.
На Github в README.db в начале проекта можно увидеть статут работы проекта.
Проект - http://84.252.143.113/admin/


Проект отзывов YaMDb в рамках обучения на Яндекс Практикум. Благодаря этому проекту можно оставлять отзывы на произведения в различных категориях (например -книги, фильмы, музыка). Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы и оценивают произведение по шкале от 1 до 10. Исходя из среднего значения оценое формируется рейтинг произведения. На одно произведение уникальный пользователь может оставить только один отзыв.

## Характеристики

Аутентификация по JWT-токену

Работает со всеми модулями социальной YaMDb: произведениями, отзывами, категориями, жанрами, комментариями.

Получение списка всех категорий, добавление новой категории, удаление категории.

Получение списка всех жанров, добавление жанра, удаление жанра.

Получение списка всех произведений, добавление произведения, удаление произведения.

Получение информации о произведении, частичное обновление информации о произведении.

Получение списка всех отзывов, добавление нового отзыва, полуение отзыва по id.

Частичное обновление отзыва по id, удаление отзыва по id.

Получение списка всех комментариев к отзыву, добавление комментария к отзыву, получение комментария к отзыву.

Частичное обновление комментария к отзыву, удаление комментария к отзыву.

Получение списка всех пользователей, добавление пользователя, получение пользователя по username.

Изменение данных пользователя по username, удаление пользователя по username.

Получение данных своей учетной записи, Изменение данных своей учетной записи.

Поддерживает методы GET, POST, PUT, PATCH, DELETE

Предоставляет данные в формате JSON


## Стек технологий

- Django REST Framework v.3.12.4- написание проекта на Python v.3.7+
- Simple JWT(djangorestframework-simplejwt v.4.7.2) - работа с JWT-токеном
- Git v.2.35.1 - управление версиями
- Docker — программное обеспечение для автоматизации развёртывания и управления приложениями 
в средах с поддержкой контейнеризации
- Nginx - веб-сервер и почтовый прокси-сервер, работающий на Unix-подобных операционных системах
- PostgreSQL - свободная объектно-реляционная система управления базами данных (СУБД)

## Подготовка ПО

### Инструкция для Windows

Установите программное обеспечение: скачайте установочные файлы и запустите их.

Python: https://python.org/downloads/

Visual Studio Code: https://visualstudio.com/download/

Git: https://git-scm.com/download/win/

Docker: https://www.docker.com/products/docker-desktop/

### Инструкция для Linux (Ubuntu)

Запустите программу Терминал.

1) Сперва установите Python, для этого в терминале выполните команду. Перед установкой терминал попросит вас ввести пароль администратора — сделайте это.
```
sudo apt-get install python3.7 
```
2) По такой же схеме установите Git
```
sudo apt-get install git 
```
3)Чтобы установить редактор вам понадобится менеджер пакетов `snap`. Установите его командой
```
sudo apt install snap 
```
4) Устанавливаем редактор Visual Studio Code из дополнительного набора пакетов:
```
sudo snap install code --classic 
```
5) После того, как всё скачается и установится, вы сможете запустить Visual Studio Code командой `code` в терминале.

### Лоакльный запуск проекта

1) После установки ПО откройте VSCode и откройте терминал (Терминал - Создать терминал). Внизу справа 
нажмите `+` и выберите Git Bash (если предпочитаете пользоваться стандартной командной строкой 
powershell, то используйте их).

2) В командной строке войдите в директорию, где планируете развернуть проект. Например:
```
cd /c/Dev/
```
3) Необходимо склонировать репозитарий проекта:
```
git clone https://github.com/Ampolirosinvest/yamdb_final.git
```
Теперь ваш проект будет храниться в дериктории например: `/c/Dev/yamdb_final`

4) Установите виртуальное окружение
```
python3 -m venv venv
```
5) Активируйте виртуальное окружение
```
. venv/Scripts/activate
```
5) Установите зависимости внутри виртуального окружения
```
pip install -r requirements.txt
```

### Подготовка локального ПО для установки Docker

1) Windows 10: Корпоративная и Pro

Для Корпоративной и Pro-версий Windows виртуализация настраивается на основе гипервизора Hyper-V.
Включите его: перейдите в Панель управления — Программы и компоненты — Включение и отключение компонентов Windows -активируйте пункт Hyper-V - перезагрузите компьютер

2) Windows 10 Home

Для корректной работы Docker в Windows 10 Home установите подсистему Linux (WSL2), описание действией смотрите на официальнос странице - https://docs.microsoft.com/ru-ru/windows/wsl/install

3) Windows 7

Для настройки системы виртуализации в Windows 7:
- скачайте и установите специальную программу для работы с виртуальными машинами, например, VMWare или VirtualBox;
- скачайте образ Ubuntu;
- установите Docker по инструкции для Linux (она ниже в этом уроке).

### Установка Docker на на Windows 10/11 и MacOS

Зайдите на официальный сайт проекта и скачайте установочный файл Docker Desktop для вашей операционной системы - https://www.docker.com/products/docker-desktop/

Запустите его и следуйте инструкциям по установке. Для Windows программа предложит установить необходимые компоненты для WSL2. Поставьте галочку, если будете использовать эту систему виртуализации.

После установки запустите приложение. Программа предложит принять лицензионное соглашение. Ознакомьтесь со всеми терминами, поставьте галочку возле пункта I accept the terms и нажмите кнопку Accept.

Далее вы можете пройти стартовое руководство. Нажмите кнопку Start, если хотите это сделать, а если нет — нажимайте Skip tutorial и переходите к рабочему пространству.

Docker Desktop готов к работе! Зелёная полоска с китом в левом нижнем углу окна приложения означает, что сервис успешно запустился.

### Установка Docker на Linux

Скачать и выполнить официальный скрипт:
```
# Установка утилиты для скачивания файлов
sudo apt install curl
# Эта команда скачает скрипт для установки докера
curl -fsSL https://get.docker.com -o get-docker.sh
# Эта команда запустит его
sh get-docker.sh  
```

### Подготовка боевого сервера

Для начала войдите на свой сервер, который развернут в яндекс облаке

1) Остановите службу nginx
```
 sudo systemctl stop nginx
```

2) Установите docker
```
sudo apt install docker.io
```

3) Установите docker-compose
```
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

Скопируйте файлы docker-compose.yaml и nginx/default.conf из вашего проекта на сервер в home/<ваш_username>/docker-compose.yaml и home/<ваш_username>/nginx/default.conf соответственно

Теперь боевой сервер готов к разворачиванию на нем контейнеров, которые мы задеплоим на сервер согласно инструкции workflow.

### Подготовка секретных данных

1)Зайдите в репозиторий на Github - sittings - secrets -actions

2) Жмем New repository secret и добавляем следующие значения:

HOST - ip вашего удалённого сервера
USER - имя пользователя
SSH_KEY
PASSPHRASE - пароль
DB_ENGINE - можно использовать значение 'django.db.backends.postgresql'
POSTGRES_USER - можно использовать значение postgres 
POSTGRES_PASSWORD  - можно использовать значение postgres
DB_HOST - можно использовать значение db
DB_PORT - можно использовать значение 5432
DOCKER_PASSWORD - пароль от dockerhub
DOCKER_USERNAME - имя пользователя dockerhub
TELEGRAM_TO - id вашего телеграм аккаунта
TELEGRAM_TOKEN - токен телеграм-бота (в workflow настроена отправка ботом сообщения об успешном деплое проекта на удалённый сервер)

### Описание сборки проекта

В проекте в папке .github/workflows в файле `yamdb_workflow.yml` описан список операций.

При выполнении команды git push проект заливается в репозитарий и начинается проверка проекта
согласно описанным операциям:

1) Проверка кода на соответствие стандарту PEP8

2) Сборка и доставка докер-образа для контейнера `web` на Docker Hub

3) Автоматический деплой проекта на боевой сервер

4) Отправка уведомления в Telegram о том, что процесс деплоя успешно завершился

На Github в репозитарии во вкладке Actions можно увидеть процесс проверки проекта по workflow.

### Последние приготовления:

На боевом сервере необходимо провести миграции, создать суперпользователя и подключить статику

1) Миграции 
``` 
sudo docker-compose exec web python manage.py makemigrations reviews 
``` 
``` 
sudo docker-compose exec web python manage.py migrate --run-syncdb
``` 

2)Суперпользователь
``` 
sudo docker-compose exec web python manage.py createsuperuser 
``` 

3) Статика
``` 
sudo docker-compose exec web python manage.py collectstatic --no-input 
``` 